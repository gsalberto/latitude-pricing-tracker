generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model City {
  id                 String              @id @default(cuid())
  code               String              @unique
  name               String
  country            String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  competitorProducts CompetitorProduct[]
}

model LatitudeProduct {
  id                 String                  @id @default(cuid())
  name               String                  @unique
  cpu                String
  cpuCores           Int
  ram                Int
  storageDescription String
  storageTotalTB     Float
  networkGbps        Int
  priceUsd           Float
  generation         Int                     @default(4)
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt
  comparisons        Comparison[]
  regionalPrices     LatitudeRegionalPrice[]
}

model LatitudeRegionalPrice {
  id                String          @id @default(cuid())
  latitudeProductId String
  region            String
  priceUsd          Float
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  latitudeProduct   LatitudeProduct @relation(fields: [latitudeProductId], references: [id], onDelete: Cascade)

  @@unique([latitudeProductId, region])
}

model CompetitorProduct {
  id                 String       @id @default(cuid())
  competitor         Competitor
  name               String
  cpu                String
  cpuCores           Int
  ram                Int
  storageDescription String
  storageTotalTB     Float
  networkGbps        Int
  cityId             String
  priceUsd           Float
  sourceUrl          String
  inStock            Boolean      @default(true)
  lastInventoryCheck DateTime?
  inventoryUrl       String?
  lastVerified       DateTime     @default(now())
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  quantity           Int?
  comparisons        Comparison[]
  city               City         @relation(fields: [cityId], references: [id])

  @@unique([competitor, name, cityId])
}

model Comparison {
  id                       String            @id @default(cuid())
  latitudeProductId        String
  competitorProductId      String
  notes                    String?
  priceDifferencePercent   Float
  latitudeRegionalPriceUsd Float?            // Regional price used for this comparison
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @updatedAt
  competitorProduct        CompetitorProduct @relation(fields: [competitorProductId], references: [id], onDelete: Cascade)
  latitudeProduct          LatitudeProduct   @relation(fields: [latitudeProductId], references: [id], onDelete: Cascade)

  @@unique([latitudeProductId, competitorProductId])
}

model PriceHistory {
  id                  String     @id @default(cuid())
  competitorProductId String
  competitor          Competitor
  productName         String
  cityName            String
  oldPrice            Float
  newPrice            Float
  changePercent       Float
  recordedAt          DateTime   @default(now())

  @@index([competitorProductId])
  @@index([recordedAt])
}

enum Competitor {
  VULTR
  OVHCLOUD
  HETZNER
  TERASWITCH
  CHERRYSERVERS
  LIMESTONENETWORKS
  SERVERSCOM
  DATAPACKET
  PHOENIXNAP
  LEASEWEB
  SCALEWAY
  LIQUIDWEB
  IBM
  OCI
}
